
import re
import sys
import hashlib

def get_file_hashes(file_path):
    """CalculeazÄƒ amprentele digitale ale fiÈ™ierului."""
    with open(file_path, "rb") as f:
        data = f.read()
        md5 = hashlib.md5(data).hexdigest()
        sha256 = hashlib.sha256(data).hexdigest()
    return md5, sha256

def extract_strings(file_path):
    """CautÄƒ text suspect Ã®n interiorul fiÈ™ierului binar."""
    with open(file_path, "rb") as f:
        content = f.read()
    
    # CÄƒutÄƒm orice text lizibil de minim 4 caractere
    all_strings = re.findall(rb"[ -~]{4,}", content)
    
    suspicious_indicators = [".exe", "http", "https", "powershell", "cmd.exe", "192.168.", "C:\\"]
    found_suspicious = []

    for s in all_strings:
        try:
            decoded = s.decode('utf-8').lower()
            if any(indicator in decoded for indicator in suspicious_indicators):
                found_suspicious.append(decoded)
        except:
            continue
            
    return found_suspicious

def run_analysis(file_path):
    print(f"\n{'='*40}")
    print(f"ğŸ” ANALIZÄ‚ STATICÄ‚: {file_path}")
    print(f"{'='*40}")
    
    # 1. Hashes
    md5, sha256 = get_file_hashes(file_path)
    print(f"[+] MD5: {md5}")
    print(f"[+] SHA256: {sha256}")
    print(f"ğŸ”— VerificÄƒ pe VirusTotal: https://www.virustotal.com/gui/file/{sha256}")
    
    # 2. Strings suspecte
    print(f"\n[*] Se cautÄƒ indicatori suspecÈ›i (IP-uri, URL-uri, comenzi)...")
    suspicious = extract_strings(file_path)
    
    if suspicious:
        for item in set(suspicious): # Folosim set() ca sÄƒ nu avem duplicate
            print(f"  [!] GÄƒsit: {item}")
    else:
        print("  [-] Nu s-au gÄƒsit indicatori evidenÈ›i.")
    print(f"\n{'='*40}\n")

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("Utilizare: python3 static_analyzer.py <nume_fisier>")
    else:
        run_analysis(sys.argv[1])
